// ---------------------------------------------------------------------------
// String parser tools

// Find context
@function find-context($columns, $gutter, $margin) {

  // If auto columns exist, context needs to be calculated.
  @if query-list($columns, auto) != false or length(columns) == 1 {
    @return nth($context, nth(query-list($context, unit($gutter), unit), 1));
  }
  @else {

    // Find sum of columns
    $column-sum: list-sum($columns);

    // Find sum of gutters
    $gutter-sum: $gutter * (column-count($columns) - 1);

    // Find sum of margin
    $margin-sum: list-sum($margin);
    @if type-of($margin) == number {
      $margin-sum: $margin * 2;
    }

    @return $column-sum + $gutter-sum + $margin-sum;
  }
}

// ---------------------------------------------------------------------------
// String parser

// Global defaults so changes cascade into other functions.
$susy-span        : false ;
$susy-location    : false ;
$susy-columns     : false ;
$susy-context     : false ;
$susy-gutters     : false ;
$susy-margin      : false ;

// Parse the string into the above global vars.
// The string just pass through this, the function itself does not return anything useful.
@function parse-string($string) {

  // Set counter to one.
  $i              : 1     ;

  // Zero out global variables.
  $susy-span      : false ;
  $susy-location  : false ;
  $susy-columns   : false ;
  $susy-context   : false ;
  $susy-gutters   : false ;
  $susy-margin    : false ;

  @while $i <= length($string) {
    
    // Span
    @if type-of(nth($string, $i)) == number {
      $susy-span: nth($string, $i);
    }

    // Location
    @elseif nth($string, $i) == first {
      $susy-location: 1;
    }
    @elseif nth($string, $i) == last {
      $susy-location: last;
    }
    @elseif nth($string, $i) == at {
      $i: $i + 1;
      $susy-location: nth($string, $i);
    }

    // Columns
    @elseif nth($string, $i) == of {
      $i: $i + 1;
      $susy-columns: nth($string, $i);
    }


    // Bump up counter
    $i: $i + 1;
  }

  // Global variables re-written. Spit out the string without changes.
  @return $string;
}