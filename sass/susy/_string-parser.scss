// ---------------------------------------------------------------------------
// String parser

// Global defaults so changes cascade into other functions.
$susy-span        : false ;
$susy-location    : false ;
$susy-columns     : false ;
$susy-context     : false ;
$susy-gutters     : false ;
$susy-margin      : false ;

// Parse the string into the above global vars.
// The string just pass through this, the function itself does not return anything useful.
@function format-string($string) {

  // Set counter to one.
  $i              : 1     ;

  // Zero out global variables.
  $susy-span      : false ;
  $susy-location  : false ;
  $susy-columns   : false ;
  $susy-context   : false ;
  $susy-gutters   : false ;
  $susy-margin    : false ;

  @while $i <= length($string) {
    
    // Span
    @if type-of(nth($string, $i)) == number {
      $susy-span: nth($string, $i);
    }

    // Location
    @elseif nth($string, $i) == first {
      $susy-location: 1;
    }
    @elseif nth($string, $i) == last {
      $susy-location: last;
    }
    @elseif nth($string, $i) == at {
      $i: $i + 1;
      $susy-location: nth($string, $i);
    }

    // Columns
    @elseif nth($string, $i) == of {
      $i: $i + 1;
      $susy-columns: nth($string, $i);
    }


    // Bump up counter
    $i: $i + 1;
  }

  // Global variables re-written. Spit out the string without changes.
  @return $string;
}

@function parse-string($var, $string) {
  @return find-context($columns, $gutter, $margin);
}