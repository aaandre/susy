// Float isolation
// ===============

// Calculate isolation position
@function get-isolation-position(
  $span             : 1,
  $location         : 1,
  $columns          : $columns,
  $gutters          : $gutters,
  $column-width     : $column-width,
  $gutter-position  : $gutter-position,
  $container-width  : $container-width,
  $static           : $static-output
) {
  $push   : get-location-position($span, $location, $columns) - 1;
  $before : null;

  @if $push > 0 {
    $before: get-span-outer-width($push, 1, $columns, $gutters, $column-width, $gutter-position, $container-width, $static);
  }

  @return $before;
}

// Isolation Override
@mixin isolate(
  $location,
  $columns  : $columns,
  $gutters  : $gutters,
  $column-width: $column-width,
  $gutter-position: $gutter-position,
  $container-width: $container-width,
  $static   : $static-output,
  $flow     : $direction
) {
  $to     : to($flow);
  $from   : from($flow);

  $before : get-isolation-position(1, $location, $columns, $gutters, $column-width, $gutter-position, $container-width, $static);
  $after  : -100%;

  margin-#{$from}: $before;
  margin-#{$to}: $after;
}

// Isolation Grid
@mixin isolate-grid(
  $span,
  $columns  : $columns,
  $gutters  : $gutters,
  $selector : child,
  $column-width: $column-width,
  $gutter-position: $gutter-position,
  $container-width: $container-width,
  $static   : $static-output,
  $flow     : $direction
) {
  $to       : to($flow);
  $from     : from($flow);

  $location : 1;
  $context  : column-count($columns);
  $line     : floor($context / $span);

  $width    : get-span-width($span, $location, $columns, $gutters, $column-width, $gutter-position, $container-width, $static);
  $width    : if(is-symmetrical($columns), $width, null);

  @include float-span-output($width, $from);
  margin-#{$to}: -100%;

  @for $item from 1 through $line {
    $nth: '#{$line}n + #{$item}';
    &:#{format-nth($nth,$selector)} {
      $width: get-span-width($span, $location, $columns, $gutters, $column-width, $gutter-position, $container-width, $static);
      $width: if(is-symmetrical($columns), null, $width);
      $before: get-isolation-position($span, $location, $columns, $gutters, $column-width, $gutter-position, $container-width, $static);

      width: $width;
      margin-#{$from}: $before;

      @if $location == 1 { clear: $from; }
      $location: $location + $span;
      @if $location > $context { $location: 1; }
    }
  }
}
